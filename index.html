<!DOCTYPE html>
<html lang="en">

<head>
  <meta name="view-transition" content="same-origin">
  <meta charset="UTF-8">
  <link rel="icon" type="image/svg+xml" href="/logo.png" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description"
    content="St. John Paul II Vocational & High School Mbalala-Mukono. Providing holistic education through academic excellence and practical vocational skills. Join us for a brighter future.">
  <meta name="keywords"
    content="SJPII, St. John Paul II, Vocational School Mukono, High School Uganda, Mbalala School, Technical Education Uganda">
  <title>St. John Paul II Vocational & High School | Empowering Futures</title>
  <!-- FontAwesome for Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link rel="stylesheet" href="/src/style.css">

  <!-- SEO & Social Meta Tags -->
  <meta property="og:title" content="St. John Paul II Vocational & High School">
  <meta property="og:description"
    content="Empowering Futures Through Education & Skills. Join us for holistic academic excellence and practical vocational training.">
  <meta property="og:image" content="https://stjohnpaulvocational.com/hero-main.png">
  <meta property="og:url" content="https://stjohnpaulvocational.com/">
  <meta property="og:type" content="website">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="St. John Paul II Vocational & High School">
  <meta name="twitter:description"
    content="Empowering Futures Through Education & Skills. Join us for holistic academic excellence and practical vocational training.">
  <meta name="twitter:image" content="https://stjohnpaulvocational.com/hero-main.png">

  <!-- Performance Hints -->
  <link rel="preload" as="image" href="/hero-main.png">
</head>

<body>
  <nav class="navbar">
    <div class="container">
      <a href="/" class="logo" style="text-decoration: none;">
        <h2 style="color: var(--color-primary); margin: 0; font-size: 1.2rem;">St. John Paul II Vocational & High School
        </h2>
      </a>
      <!-- Links will be injected by main.js -->
    </div>
  </nav>

  <main>
    <!-- Hero Section with Slider -->
    <section class="hero-slider">
      <div class="slider-container">
        <div class="slide active"
          style="background: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url('/hero-main.png') center/cover;">
          <div class="container">
            <div class="hero-content">
              <h1
                style="color: white; font-size: clamp(2.5rem, 5vw, 4.5rem); text-shadow: 2px 2px 15px rgba(0,0,0,0.7);">
                Empowering Futures Through Education & Skills</h1>
              <p style="color: var(--color-accent); font-size: 1.5rem; font-weight: 700; margin-bottom: 30px;">
                St. John Paul II Vocational & High School</p>
              <div style="display: flex; gap: 20px;">
                <a href="/admissions.html" class="btn btn-primary btn-lg">Join Us Today</a>
                <a href="/programs.html" class="btn btn-outline btn-lg"
                  style="color: white; border: white 1px solid;">Our
                  Programs</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Stats Section -->
    <section class="stats-bar" style="background: var(--color-primary); color: white; padding: 40px 0;">
      <div class="container">
        <div class="grid-4-col" style="text-align: center;">
          <div class="stat-item">
            <h2 style="color:  #8B0000; margin-bottom: 5px;">15+</h2>
            <p style="text-transform: uppercase; font-size: 0.8rem; letter-spacing: 1px;">Years Excellence</p>
          </div>
          <div class="stat-item">
            <h2 style="color: #8B0000; margin-bottom: 5px;">500+</h2>
            <p style="text-transform: uppercase; font-size: 0.8rem; letter-spacing: 1px;">Current Students</p>
          </div>
          <div class="stat-item">
            <h2 style="color: #8B0000; margin-bottom: 5px;">20+</h2>
            <p style="text-transform: uppercase; font-size: 0.8rem; letter-spacing: 1px;">Certified Courses</p>
          </div>
          <div class="stat-item">
            <h2 style="color: #8B0000; margin-bottom: 5px;">98%</h2>
            <p style="text-transform: uppercase; font-size: 0.8rem; letter-spacing: 1px;">Employment Rate</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Welcome Section -->
    <section class="welcome-section" style="padding: 100px 0;">
      <div class="container">
        <div class="welcome-grid">
          <div class="welcome-text" id="section-home_about">
            <h4 data-field="subtitle"
              style="color: var(--color-primary); font-weight: 700; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px;">
              Welcome to Excellence</h4>
            <h2 data-field="title" style="font-size: 3rem; margin-bottom: 30px;">Holistic Education for a Changing World
            </h2>
            <div data-field="content" style="color: var(--gray-600); line-height: 1.8; margin-bottom: 30px;">At St. John
              Paul II Vocational &
              High School, we believe in nurturing the whole person...</div>

            <a href="/about.html" class="btn btn-primary" data-field="button">Learn More About Us</a>
          </div>
          <div class="welcome-image" style="position: relative;">
            <img id="img-home_about" src="/hero-main.png" alt="Students"
              style="width: 100%; border-radius: 30px; box-shadow: var(--shadow-2xl);">
            <div
              style="position: absolute; bottom: -30px; right: -30px; background: var(--color-secondary); color: white; padding: 30px; border-radius: 20px; box-shadow: var(--shadow-xl); max-width: 200px;">
              <h3 style="color: white; margin-bottom: 5px;">2026</h3>
              <p style="font-size: 0.8rem; font-weight: 600;">Admissions are currently open!</p>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Purpose & Values Section -->
    <section class="mission-vision-section" style="padding: 100px 0;">
      <div class="container">
        <div class="section-title" style="text-align: center; margin-bottom: 60px;">
          <h4
            style="color: var(--color-primary); font-weight: 700; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px;">
            Our Foundation
          </h4>
          <h2>Guided by Purpose & Values</h2>
        </div>

        <!-- Goal, Mission, Vision -->
        <div class="purpose-grid">
          <div class="purpose-box goal-box">
            <h2 style="margin-bottom: 25px;">Our Goal</h2>
            <p style="color: var(--gray-600); line-height: 1.8; font-size: 1.1rem;">"To equip our students
              with knowledge and practical skills to enable them become productive, creative, responsible,
              ethical to thrive and succeed in life."</p>
          </div>
          <div class="purpose-box mission-box">
            <h2 style="margin-bottom: 25px;">Our Mission</h2>
            <p style="color: var(--gray-600); line-height: 1.8; font-size: 1.1rem;">"To provide quality
              education that is holistic, practical and accessible, aimed at nurturing graduates who are
              God-fearing, innovators and productive citizens of the global community."</p>
          </div>
          <div class="purpose-box vision-box">
            <h2 style="margin-bottom: 25px;">Our Vision</h2>
            <p style="color: var(--gray-600); line-height: 1.8; font-size: 1.1rem;">"A leading centre of
              excellence in academic and vocational education, transforming lives through skills and
              character development."</p>
          </div>
        </div>

        <!-- Core Values -->
        <div class="core-values" style="margin-top: 80px; text-align: center;">
          <h2 style="margin-bottom: 20px;">Our Core Values</h2>
          <div style="width: 80px; height: 4px; background: var(--color-accent); margin: 0 auto 50px;"></div>
          <div class="values-grid">
            <div class="value-item">
              <i class="fas fa-user-shield"></i>
              <h4>Integrity</h4>
              <p style="font-size: 0.9rem;">Honesty and responsibility in all actions.</p>
            </div>
            <div class="value-item">
              <i class="fas fa-book-reader"></i>
              <h4>Discipline</h4>
              <p style="font-size: 0.9rem;">The foundation of success and character.</p>
            </div>
            <div class="value-item">
              <i class="fas fa-cross"></i>
              <h4>God Fearing</h4>
              <p style="font-size: 0.9rem;">Remaining true to our spiritual foundation.</p>
            </div>
            <div class="value-item">
              <i class="fas fa-users"></i>
              <h4>Team Work</h4>
              <p style="font-size: 0.9rem;">Collaborating for greater achievements.</p>
            </div>
            <div class="value-item">
              <i class="fas fa-award"></i>
              <h4>Excellence</h4>
              <p style="font-size: 0.9rem;">Striving for the best in every field.</p>
            </div>
            <div class="value-item">
              <i class="fas fa-check-double"></i>
              <h4>Accountability</h4>
              <p style="font-size: 0.9rem;">Taking ownership of our responsibilities.</p>
            </div>
          </div>
        </div>

        <!-- More Details Button -->
        <div style="text-align: center; margin-top: 60px;">
          <a href="/mission-vision.html" class="btn btn-primary">More Details</a>
        </div>
      </div>
    </section>

    <!-- Video Section -->
    <section class="video-section">
      <div class="container">
        <div class="section-title" style="text-align: center; margin-bottom: 60px;">
          <h4
            style="color: var(--color-primary); font-weight: 700; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px;">
            Experience St. John Paul II Vocational & High School</h4>
          <h2>Our Vibrant Campus Life</h2>
        </div>
        <div class="video-container">
          <div class="video-wrapper" id="homeVideoContainer">
            <!-- Loading Spinner -->
            <div style="display: flex; justify-content: center; align-items: center; height: 100%; background: #000;">
              <i class="fas fa-spinner fa-spin" style="color: white; font-size: 2rem;"></i>
            </div>
          </div>
          <script type="module">
            import { API_URL, getImageUrl } from '/src/config.js';

            // URL Sanitizer & Embed Converter
            function sanitizeVideoUrl(url) {
              if (!url) return '';
              let videoId = '';
              if (url.includes('youtube.com/watch?v=')) videoId = url.split('v=')[1].split('&')[0];
              else if (url.includes('youtu.be/')) videoId = url.split('youtu.be/')[1].split('?')[0];
              else if (url.includes('youtube.com/embed/')) videoId = url.split('embed/')[1].split('?')[0];

              if (videoId) return `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=0`;

              if (url.includes('vimeo.com/') && !url.includes('player.vimeo.com')) {
                const id = url.split('vimeo.com/')[1].split('?')[0];
                return `https://player.vimeo.com/video/${id}?autoplay=1`;
              }
              return url;
            }

            // Get Thumbnail URL
            function getThumbUrl(url) {
              if (url.includes('youtube.com') || url.includes('youtu.be')) {
                let id = '';
                if (url.includes('v=')) id = url.split('v=')[1].split('&')[0];
                else if (url.includes('youtu.be/')) id = url.split('youtu.be/')[1].split('?')[0];
                else if (url.includes('embed/')) id = url.split('embed/')[1].split('?')[0];
                return id ? `https://img.youtube.com/vi/${id}/maxresdefault.jpg` : '/hero-main.png';
              }
              return '/hero-main.png'; // Fallback
            }

            // Load Video Interaction
            window.loadVideoIframe = (url) => {
              const container = document.getElementById('homeVideoContainer');
              const sanitized = sanitizeVideoUrl(url);
              container.innerHTML = `
                <iframe src="${sanitized}" title="School Video" frameborder="0"
                  style="width: 100%; height: 100%;"
                  allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                  allowfullscreen></iframe>
              `;
            };

            // Fetch dynamic video settings
            fetch(`${API_URL}/content/settings`)
              .then(async res => {
                if (!res.ok) {
                  const text = await res.text();
                  throw new Error(`HTTP error! status: ${res.status}, body: ${text.substring(0, 100)}`);
                }
                return res.json();
              })
              .then(settings => {
                const container = document.getElementById('homeVideoContainer');

                if (settings.home_video_path) {
                  // Direct MP4 Upload
                  container.innerHTML = `
                    <video controls preload="metadata" style="width: 100%; height: 100%; object-fit: cover;">
                      <source src="${getImageUrl(settings.home_video_path)}" type="video/mp4">
                      Your browser does not support the video tag.
                    </video>
                  `;
                } else if (settings.home_video_url) {
                  // Lite Embed Strategy (Thumbnail + Overlay Play Button)
                  const thumb = getThumbUrl(settings.home_video_url);
                  container.innerHTML = `
                    <div onclick="loadVideoIframe('${settings.home_video_url}')" 
                         style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: url('${thumb}') center/cover; cursor: pointer; display: flex; align-items: center; justify-content: center; border-radius: inherit;">
                      <div style="width: 80px; height: 80px; background: rgba(139, 0, 0, 0.9); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 0 30px rgba(0,0,0,0.5); transition: transform 0.3s ease; z-index: 2;" 
                           onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
                        <i class="fas fa-play" style="color: white; font-size: 30px; margin-left: 5px;"></i>
                      </div>
                      <div style="position: absolute; bottom: 20px; left: 20px; color: white; text-shadow: 2px 2px 10px rgba(0,0,0,0.8); font-weight: 700; font-size: 1.2rem; z-index: 2;">
                        <i class="fab fa-youtube"></i> Click to Watch Video
                      </div>
                      <div style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.2); z-index: 1;"></div>
                    </div>
                  `;
                } else {
                  // Fallback
                  container.innerHTML = '<div style="background: #222; height: 100%; display: flex; align-items: center; justify-content: center; color: #666;">No video available</div>';
                }
              })
              .catch(err => {
                console.error('Failed to load video settings', err);
                document.getElementById('homeVideoContainer').innerHTML = '<div style="background: #222; height: 100%; display: flex; align-items: center; justify-content: center; color: #ef4444;">Connection Error</div>';
              });
          </script>
          <div class="video-info">
            <h3>Watch Our Story</h3>
            <p>See how we are transforming lives through skills and quality education.</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Board Members Showcase Section -->
    <section style="padding: 100px 0; background: var(--white);">
      <div class="container">
        <div class="section-title" style="text-align: center; margin-bottom: 60px;">
          <h4
            style="color: var(--color-primary); font-weight: 700; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px;">
            Our Governance</h4>
          <h2>Board of Governors</h2>
          <p style="color: var(--gray-600); max-width: 600px; margin: 20px auto 0;">
            Meet our distinguished board members who guide our institution with wisdom and dedication.
          </p>
        </div>
        <div class="management-grid" id="board-members-showcase">
          <!-- Dynamic board members will load here -->
          <p style="text-align: center; grid-column: 1/-1;">Loading board members...</p>
        </div>
      </div>
    </section>

    <!-- Chairman Message Section -->
    <section style="padding: 100px 0; background: var(--gray-50);">
      <div class="container">
        <div class="section-title" style="text-align: center; margin-bottom: 60px;">
          <h4
            style="color: var(--color-primary); font-weight: 700; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px;">
            Leadership Voice</h4>
          <h2 id="chairman-section-title">Message from the Chairman</h2>
        </div>
        <div class="story-grid" id="section-chairman_message">
          <div class="story-image">
            <img id="img-chairman_message" src="/hero-main.png" alt="Chairman"
              style="width: 100%; border-radius: 20px; box-shadow: var(--shadow-xl);">
          </div>
          <div class="story-text">
            <h4 data-field="subtitle" style="color: var(--color-secondary); font-weight: 700; margin-bottom: 15px;">
              Board of Governors</h4>
            <h3 data-field="title" style="font-size: 2rem; margin-bottom: 20px; color: var(--color-primary);">Message
              from the Chairman</h3>
            <p data-field="content" style="color: var(--gray-600); line-height: 1.8; margin-bottom: 20px;">
              Loading message...
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- Head Prefect Message Section -->
    <section style="padding: 100px 0; background: var(--white);">
      <div class="container">
        <div class="section-title" style="text-align: center; margin-bottom: 60px;">
          <h4
            style="color: var(--color-primary); font-weight: 700; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px;">
            Student Voice</h4>
          <h2 id="prefect-section-title">Message from the Head Prefect</h2>
        </div>
        <div class="story-grid" id="section-head_prefect_message">
          <div class="story-text">
            <h4 data-field="subtitle" style="color: var(--color-secondary); font-weight: 700; margin-bottom: 15px;">
              Student Leadership</h4>
            <h3 data-field="title" style="font-size: 2rem; margin-bottom: 20px; color: var(--color-primary);">Message
              from the Head Prefect</h3>
            <p data-field="content" style="color: var(--gray-600); line-height: 1.8; margin-bottom: 20px;">
              Loading message...
            </p>
          </div>
          <div class="story-image">
            <img id="img-head_prefect_message" src="/facilities.png" alt="Head Prefect"
              style="width: auto; max-width: 100%; height: auto; max-height: 450px; border-radius: 20px; box-shadow: var(--shadow-xl);">
          </div>
        </div>
      </div>
    </section>

    <!-- Latest News & Upcoming Events -->
    <section style="padding: 100px 0; background: var(--gray-50);">
      <div class="container">
        <div class="grid-2-col" style="gap: 60px;">
          <!-- News Snippet -->
          <div>
            <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 40px;">
              <div>
                <h4
                  style="color: var(--color-primary); font-weight: 700; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 10px;">
                  Stay Updated</h4>
                <h2 style="margin: 0;">Latest News</h2>
              </div>
              <a href="/news.html" style="color: var(--color-primary); font-weight: 700;">View All News <i
                  class="fas fa-arrow-right"></i></a>
            </div>

            <div style="display: grid; gap: 25px;">
              <article
                style="display: flex; gap: 20px; background: white; padding: 20px; border-radius: 12px; box-shadow: var(--shadow-sm); transition: transform 0.3s ease;"
                onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                <img src="/hero-main.png" style="width: 120px; height: 100px; border-radius: 8px; object-fit: cover;">
                <div>
                  <span style="font-size: 0.75rem; color: var(--color-primary); font-weight: 700;">JAN 18, 2026</span>
                  <h4 style="margin: 8px 0; font-size: 1.1rem;">2026 Admissions Now Open</h4>
                  <p style="font-size: 0.85rem; color: var(--gray-600); line-height: 1.4;">Start your success journey
                    with our academic and vocational programs...</p>
                </div>
              </article>
              <article
                style="display: flex; gap: 20px; background: white; padding: 20px; border-radius: 12px; box-shadow: var(--shadow-sm); transition: transform 0.3s ease;"
                onmouseover="this.style.transform='translateY(-5px)'" onmouseout="this.style.transform='translateY(0)'">
                <img src="/facilities.png" style="width: 120px; height: 100px; border-radius: 8px; object-fit: cover;">
                <div>
                  <span style="font-size: 0.75rem; color: var(--color-primary); font-weight: 700;">JAN 15, 2026</span>
                  <h4 style="margin: 8px 0; font-size: 1.1rem;">New ICT Lab Equipment</h4>
                  <p style="font-size: 0.85rem; color: var(--gray-600); line-height: 1.4;">Upgrading our technical
                    facilities to provide the best digital skills training...</p>
                </div>
              </article>
            </div>
          </div>

          <!-- Events Snippet -->
          <div>
            <div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 40px;">
              <div>
                <h4
                  style="color: var(--color-primary); font-weight: 700; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 10px;">
                  Mark Your Calendar</h4>
                <h2 style="margin: 0;">Upcoming Events</h2>
              </div>
              <a href="/events.html" style="color: var(--color-primary); font-weight: 700;">Full Calendar <i
                  class="fas fa-arrow-right"></i></a>
            </div>

            <div style="display: grid; gap: 25px;">
              <div
                style="display: flex; background: white; border-radius: 12px; box-shadow: var(--shadow-sm); overflow: hidden;">
                <div
                  style="background: var(--color-primary); color: white; padding: 20px; min-width: 100px; text-align: center; display: flex; flex-direction: column; justify-content: center;">
                  <span style="font-size: 1.5rem; font-weight: 700; display: block;">05</span>
                  <span style="font-size: 0.8rem; font-weight: 600; text-transform: uppercase;">FEB</span>
                </div>
                <div style="padding: 20px;">
                  <h4 style="margin-bottom: 5px;">Term I Opening Day</h4>
                  <p style="font-size: 0.85rem; color: var(--gray-600);">Welcome back for the first term of the 2026
                    academic year.</p>
                </div>
              </div>
              <div
                style="display: flex; background: white; border-radius: 12px; box-shadow: var(--shadow-sm); overflow: hidden;">
                <div
                  style="background: var(--color-secondary); color: white; padding: 20px; min-width: 100px; text-align: center; display: flex; flex-direction: column; justify-content: center;">
                  <span style="font-size: 1.5rem; font-weight: 700; display: block;">29</span>
                  <span style="font-size: 0.8rem; font-weight: 600; text-transform: uppercase;">MAR</span>
                </div>
                <div style="padding: 20px;">
                  <h4 style="margin-bottom: 5px;">Term I Visiting Day</h4>
                  <p style="font-size: 0.85rem; color: var(--gray-600);">Monthly parental engagement and student welfare
                    review session.</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Testimonials Section -->
    <section class="testimonials">
      <div class="container">
        <div class="section-title" style="text-align: center; margin-bottom: 60px;">
          <h4
            style="color: var(--color-primary); font-weight: 700; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px;">
            Voices of Success</h4>
          <h2>What Our Community Says</h2>
        </div>
      </div>
      <div class="testimonial-track" id="testimonialTrack">
        <p style="text-align: center; width: 100%; color: var(--gray-500);">Loading testimonials...</p>



      </div>
    </section>

    <!-- Map Section -->
    <section class="map-section professional">
      <div class="container">
        <div class="section-title" style="text-align: center; margin-bottom: 40px;">
          <h4
            style="color: var(--color-primary); font-weight: 700; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 15px;">
            Our Location</h4>
          <h2>Visit Us at Mbalala-Mukono</h2>
        </div>
        <div class="map-container-wrapper" style="display: flex; justify-content: center;">
          <iframe
            src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d7979.49150857146!2d32.834924!3d0.34556399999999493!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x177dc44b15e77a47%3A0xec9a7830597db6e3!2sSt.John%20Paul%20II%20Vocational%20Training%20Institute!5e0!3m2!1sen!2sug!4v1768299732034!5m2!1sen!2sug"
            width="600" height="450" style="border:0; border-radius: 16px; box-shadow: var(--shadow-lg);"
            allowfullscreen="" referrerpolicy="no-referrer-when-downgrade">
          </iframe>
        </div>
      </div>
    </section>

    <!-- Final CTA Section -->
    <section class="cta-section">
      <div class="container apply-intake-section">
        <h2 style="color: var(--color-primary); margin-bottom: 20px;">Ready to start your journey?</h2>
        <p style="color: var(--color-primary); margin-bottom: 40px; opacity: 0.9;">Join the thousands of graduates who
          have found success with our practical approach.</p>
        <a href="/admissions.html" class="btn btn-primary apply-btn"
          style="padding: 15px 40px; font-size: 1.2rem;">Apply
          Now for 2026 Intake</a>
      </div>
    </section>

  </main>

  <footer class="footer"></footer>

  <script type="module" src="/src/main.js"></script>
  <script type="module">
    import { API_URL, getImageUrl } from '/src/config.js';

    // Newsletter Submission (Homepage)
    const homeNewsForm = document.getElementById('homeNewsletterForm');
    if (homeNewsForm) {
      homeNewsForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        const email = homeNewsForm.querySelector('input[name="email"]').value;
        try {
          const res = await fetch(`${API_URL}/content/newsletter/subscribe`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email })
          });

          if (!res.ok) {
            const text = await res.text();
            console.error('Newsletter error body:', text);
            throw new Error(`Server returned ${res.status}`);
          }

          const data = await res.json();
          if (res.ok) {
            alert('Subscribed successfully!');
            homeNewsForm.reset();
          } else {
            alert(data.message || 'Subscription failed');
          }
        } catch (err) {
          console.error(err);
          alert('Error connecting to server');
        }
      });
    }

    // Dynamic Page Sections Loader
    async function loadSections() {
      try {
        const res = await fetch(`${API_URL}/content/sections`);
        if (!res.ok) {
          const text = await res.text();
          throw new Error(`HTTP error! status: ${res.status}, body: ${text.substring(0, 100)}`);
        }
        const sections = await res.json();

        sections.forEach(section => {
          // Handle 'home_hero'
          if (section.section_key === 'home_hero') {
            const slider = document.querySelector('.slider-container');
            if (slider) {
              slider.innerHTML = `
                  <div class="slide active" style="background: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url('${getImageUrl(section.image_url)}') center/cover;">
                    <div class="container">
                      <div class="hero-content">
                        <h1 style="color: white; font-size: clamp(2.5rem, 5vw, 4.5rem); text-shadow: 2px 2px 15px rgba(0,0,0,0.7);">${section.title}</h1>
                        <p style="color: var(--color-accent); font-size: 1.5rem; font-weight: 700; margin-bottom: 30px;">${section.subtitle}</p>
                        <div style="display: flex; gap: 20px;">
                          <a href="${section.button_link || '/admissions.html'}" class="btn btn-primary btn-lg">${section.button_text || 'Join Us Today'}</a>
                          <a href="/programs.html" class="btn btn-outline btn-lg" style="color: white; border: white 1px solid;">Our Programs</a>
                        </div>
                      </div>
                    </div>
                  </div>
                `;
            }
          }

          // Handle 'home_stats'
          if (section.section_key === 'home_stats') {
            const statItems = document.querySelectorAll('.stat-item');
            if (statItems.length === 4) {
              const values = section.title.split(',').map(s => s.trim());
              const labels = section.subtitle.split(',').map(s => s.trim());
              statItems.forEach((item, i) => {
                if (values[i]) item.querySelector('h2').textContent = values[i];
                if (labels[i]) item.querySelector('p').textContent = labels[i];
              });
            }
          }

          // Handle 'home_about'
          if (section.section_key === 'home_about') {
            const container = document.getElementById('section-home_about');
            if (container) {
              container.querySelector('[data-field="subtitle"]').textContent = section.subtitle;
              container.querySelector('[data-field="title"]').textContent = section.title;
              container.querySelector('[data-field="content"]').innerHTML = section.content.replace(/\n/g, '<br>');

              const btn = container.querySelector('[data-field="button"]');
              if (section.button_text) {
                btn.textContent = section.button_text;
                btn.href = section.button_link;
              }

              const img = document.getElementById('img-home_about');
              if (img && section.image_url) {
                img.src = getImageUrl(section.image_url);
              }
            }
          }

          // Handle Purpose & Values (Goal, Mission, Vision)
          if (section.section_key === 'home_goal') {
            const box = document.querySelector('.goal-box p');
            if (box) box.textContent = `"${section.content}"`;
          }
          if (section.section_key === 'home_mission') {
            const box = document.querySelector('.mission-box p');
            if (box) box.textContent = `"${section.content}"`;
          }
          if (section.section_key === 'home_vision') {
            const box = document.querySelector('.vision-box p');
            if (box) box.textContent = `"${section.content}"`;
          }

          // Handle 'chairman_message'
          if (section.section_key === 'chairman_message') {
            const container = document.getElementById('section-chairman_message');
            if (container) {
              container.querySelector('[data-field="subtitle"]').textContent = section.subtitle || 'Board of Governors';
              container.querySelector('[data-field="title"]').textContent = section.title || 'Message from the Chairman';
              container.querySelector('[data-field="content"]').textContent = section.content || '';

              const img = document.getElementById('img-chairman_message');
              if (img && section.image_url) {
                img.src = getImageUrl(section.image_url);
              }
            }
          }

          // Handle 'head_prefect_message'
          if (section.section_key === 'head_prefect_message') {
            const container = document.getElementById('section-head_prefect_message');
            if (container) {
              container.querySelector('[data-field="subtitle"]').textContent = section.subtitle || 'Student Leadership';
              container.querySelector('[data-field="title"]').textContent = section.title || 'Message from the Head Prefect';
              container.querySelector('[data-field="content"]').textContent = section.content || '';

              const img = document.getElementById('img-head_prefect_message');
              if (img && section.image_url) {
                img.src = getImageUrl(section.image_url);
              }
            }
          }
        });
      } catch (e) { console.error('Failed to load sections', e); }
    }

    // Load Board Members for Showcase (First 3)
    async function loadBoardMembers() {
      try {
        const res = await fetch(`${API_URL}/content/leadership?category=board`);
        if (!res.ok) {
          const text = await res.text();
          throw new Error(`HTTP error! status: ${res.status}, body: ${text.substring(0, 100)}`);
        }
        const boardMembers = await res.json();
        const container = document.getElementById('board-members-showcase');

        if (!boardMembers || boardMembers.length === 0) {
          container.innerHTML = '<p style="text-align: center; grid-column: 1/-1;">No board members available.</p>';
          return;
        }

        const first2 = boardMembers.slice(0, 2);
        container.innerHTML = '';

        first2.forEach(member => {
          let photo = getImageUrl(member.photo_url);

          const socialHtml = `
            <div class="social-handles">
              <a href="${member.facebook || '#'}" target="_blank" style="${!member.facebook ? 'opacity: 0.7;' : ''}"><i class="fab fa-facebook-f"></i></a>
              <a href="${member.twitter || '#'}" target="_blank" style="${!member.twitter ? 'opacity: 0.7;' : ''}"><i class="fab fa-twitter"></i></a>
              <a href="${member.linkedin || '#'}" target="_blank" style="${!member.linkedin ? 'opacity: 0.7;' : ''}"><i class="fab fa-linkedin-in"></i></a>
            </div>
          `;

          container.innerHTML += `
            <div class="management-card">
              <div class="card-image">
                <img src="${photo}" alt="${member.name}">
              </div>
              <h3>${member.name}</h3>
              <p class="management-title">${member.title}</p>
              ${socialHtml}
            </div>
          `;
        });

        container.innerHTML += `
           <div style="grid-column: 1 / -1; text-align: center; margin-top: 40px;">
             <a href="/leadership.html" class="btn btn-secondary">View All Board Members</a>
           </div>
        `;
      } catch (e) {
        console.error('Failed to load board members', e);
        document.getElementById('board-members-showcase').innerHTML = '<p style="text-align: center; grid-column: 1/-1;">Failed to load board members.</p>';
      }
    }

    // Load Testimonials Dynamically
    async function loadTestimonials() {
      try {
        const res = await fetch(`${API_URL}/content/testimonials`);
        if (!res.ok) {
          const text = await res.text();
          throw new Error(`HTTP error! status: ${res.status}, body: ${text.substring(0, 100)}`);
        }
        const testimonials = await res.json();
        const track = document.getElementById('testimonialTrack');

        if (!testimonials || testimonials.length === 0) {
          track.innerHTML = '<p style="text-align: center; width: 100%; color: var(--gray-500);">No testimonials yet.</p>';
          return;
        }

        track.innerHTML = testimonials.map(t => {
          let photo = getImageUrl(t.author_photo);

          return `
            <div class="testimonial-card">
              <i class="fas fa-quote-left"></i>
              <div class="testimonial-content">
                "${t.content}"
              </div>
              <div class="testimonial-author">
                <img src="${photo}" alt="${t.author_name}" class="author-img">
                <div class="author-info">
                  <h4>${t.author_name}</h4>
                  <span>${t.author_title || ''}</span>
                </div>
              </div>
            </div>
          `;
        }).join('');

        if (testimonials.length > 3) {
          track.innerHTML += track.innerHTML;
        }

      } catch (e) {
        console.error('Failed to load testimonials', e);
        document.getElementById('testimonialTrack').innerHTML = '<p style="text-align: center; width: 100%; color: var(--color-primary);">Failed to load testimonials.</p>';
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      loadSections();
      loadBoardMembers();
      loadTestimonials();
    });
  </script>
</body>

</html>