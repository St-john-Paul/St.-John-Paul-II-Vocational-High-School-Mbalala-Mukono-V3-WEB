<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="view-transition" content="same-origin">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Logged Out | St. John Paul II</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <link rel="stylesheet" href="/src/style.css">
    <style>
        body {
            background-color: #f4f6f9;
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0;
            flex-direction: column;
        }

        .logout-card {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 400px;
            width: 90%;
            border-top: 5px solid var(--color-primary);
        }

        .icon-circle {
            width: 70px;
            height: 70px;
            background: #eef2ff;
            color: var(--color-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            margin: 0 auto 20px;
        }

        h2 {
            color: #333;
            margin-bottom: 10px;
        }

        p {
            color: #666;
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <div class="logout-card" id="logoutConfirmation" style="display: none;">
        <div class="icon-circle" style="background: #fff3cd; color: #856404;">
            <i class="fas fa-question"></i>
        </div>
        <h2>Confirm Logout</h2>
        <p>Are you sure you want to end your session?</p>
        <div style="display: flex; gap: 10px; justify-content: center;">
            <button id="confirmLogoutBtn" class="btn btn-primary"
                style="background: #dc3545; border-color: #dc3545;">Yes, Logout</button>
            <button id="cancelLogoutBtn" class="btn" style="background: #e2e6ea; color: #333;">Cancel</button>
        </div>
    </div>

    <div class="logout-card" id="loggedOutMessage" style="display: none;">
        <div class="icon-circle">
            <i class="fas fa-sign-out-alt"></i>
        </div>
        <h2>You have been logged out</h2>
        <p>Thank you for using the Admin Portal.</p>
        <p style="font-size: 0.9rem; color: #888;">Redirecting to login in <span id="timer">3</span>...</p>
        <a href="/login.html" class="btn btn-primary" style="width: 100%; display: block;">Login Again Now</a>
    </div>

    <script type="module">
        import { getCurrentUser } from '/src/utils/auth.js';

        // Check if user is still logged in (token exists)
        const token = localStorage.getItem('token');
        const confirmDiv = document.getElementById('logoutConfirmation');
        const msgDiv = document.getElementById('loggedOutMessage');

        if (token) {
            // Show Confirmation
            confirmDiv.style.display = 'block';

            document.getElementById('confirmLogoutBtn').addEventListener('click', () => {
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                // Refresh to show logged out state
                window.location.reload();
            });

            document.getElementById('cancelLogoutBtn').addEventListener('click', () => {
                // Return to dashboard based on role or history
                const user = getCurrentUser();
                if (user && user.role === 'admin') window.location.href = '/admin/dashboard.html';
                else if (user && user.role === 'staff') window.location.href = '/staff/dashboard.html';
                else if (user && user.role === 'student') window.location.href = '/student/dashboard.html';
                else window.history.back();
            });

        } else {
            // Show Logged Out Message
            msgDiv.style.display = 'block';

            let count = 3;
            const timer = document.getElementById('timer');
            setInterval(() => {
                count--;
                timer.innerText = count;
                if (count <= 0) window.location.href = '/login.html';
            }, 1000);
        }
    </script>
</body>

</html>